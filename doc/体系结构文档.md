# 软件体系结构文档

## 目录

[TOC]

## 1. 引言

### 1.1 编制目的

&emsp;&emsp;本报告详细完成对酒店预定系统的概要设计，达到指导详细设计和开发的目的，同时实现和测试人员及用户的沟通。

&emsp;&emsp;本报告面向开发人员、测试人员及最终用户而编写，是了解系统的导航。

### 1.2 词汇表

| 词汇名称 | 词汇含义          | 备注                    |
| :------: | ----------------- | ----------------------- |
|   MVC    | 模型-视图-控制    | 无                      |
|    *     | com.example.hotel | 逻辑视图中包名称用*代替 |



### 1.3 参考资料

&emsp;&emsp;《软件工程与计算（卷二）：软件开发的技术基础》

&emsp;&emsp;  MVC模式 | 菜鸟教程

## 2. 产品概述

&emsp;&emsp;参考酒店预订系统用例文档和酒店预订系统软件需求规格说明中对产品的概括描述。

## 3. 逻辑视图

&emsp;&emsp;酒店预订系统中，选择了MVC体系结构风格，为模型、视图和控制的每个部件实例建立模块实现。模型代表一个存储数据的对象或JAVA POJO，它也可以带有逻辑，在数据变化时更新控制器；视图代表模型包含的数据的可视化；控制器作用于模型和视图上，它控制数据流向模型对象，并在数据变化时更新视图，它使视图与模型分离开。MVC体系结构的逻辑视角和逻辑设计方案如图1和图2所示。

![](https://name-not-defined.oss-cn-shanghai.aliyuncs.com/pkgfinal.png)

图1 参照体系结构风格的包图表达逻辑视角

![](https://name-not-defined.oss-cn-shanghai.aliyuncs.com/logicpngfinal.png)

图2 软件体系结构逻辑设计方案

## 4. 组合视图

### 4.1 开发包图

|   开发包   | 依赖的其他开发包             |
| :--------: | ---------------------------- |
| controller | bl, vo, po, util             |
|   blImpl   | bl, vo, po, data, enum, util |
|   config   |                              |
|   enums    |                              |
|    data    | po                           |
|    util    |                              |
|     vo     | enum                         |
|     po     | enum                         |
|     bl     | po, vo, util                 |
|  dataImpl  | data, po, vo                 |


|      主要开发包       | 依赖的其他开发包           |
| :-------------------: | -------------------------- |
|          api          | controller(extern),util    |
|         views         | api, vuex(extern),util     |
|       conponent       | vuex(extern),util          |
|        router         | views,util                 |
|         store         | antd(extern), router       |
|         util          | antd(extern)               |
| ... (lots of package) | ... (lots of dependencies) |

`前端基于node，依赖过多，故只列出主要依赖。`

![](https://name-not-defined.oss-cn-shanghai.aliyuncs.com/pic4.1.2.png)

![](https://name-not-defined.oss-cn-shanghai.aliyuncs.com/pic4.1.1.png)

`上图为后端开发包图，下图为前端开发主要类图`

### 4.2 运行时进程

- 表示软件在运行时进程间的交互，描述系统的动态结构

    - 绘制进程图

- 示意图：
    ![运行时进程](https://name-not-defined.oss-cn-shanghai.aliyuncs.com/4.2Flowchart.png)


### 4.3 物理部署

- 处理如何将软件组件映射到硬件基础设施
    - 绘制部署图
- 示意图

## 5. 架构设计

- 描述功能分解和如何在不同的层中安排软件模块
    - 描述架构中的对象，包含架构图
    - 描述组件接口信息
        - 包括：语法、前置条件、后置条件

### 5.1 模块职责

- 模块视图

![](https://name-not-defined.oss-cn-shanghai.aliyuncs.com/pic5.1.1.png)

- 前端各层职责

|    层    | 职责                                   |
| :------: | -------------------------------------- |
| 启动模块 | 负责初始化前后端通信接口，启动用户界面 |
|  展示层  | 展示界面                               |
|  存储层  | 存储各组件所需数据                     |
|   API    | 负责从后端调取所需数据                 |

- 后端各层职责

|     层     | 职责                                              |
| :--------: | ------------------------------------------------- |
|  启动模块  | 负责初始化各服务接口，等待前端调用                |
|   接口层   | 将服务封装成易于前端使用的接口                    |
| 业务逻辑层 | 完成对数据的基于业务所需的特定处理                |
|   数据层   | 简化与数据库的交互，减少程序员利用原生SQL操作数据 |

- 层之间调用接口

|                             接口                             | 服务调用方   | 服务提供方   |
| :----------------------------------------------------------: | ------------ | ------------ |
| Admin:<br/>addManager<br/>getAllManagers<br/>bindToManagers<br/>deleteHotel<br/>deleteuser<br/><br/>Coupon:<br/>addCoupon<br/>getAllByHotel<br/>getOrderMatchCoupons<br/><br/>Hotel:<br/>createHotel<br/>retrieveAllHotels<br/>addRoomInfo<br/>retrieveHotelDetail<br/>fzySearch<br/>getHotelByManager<br/>unboundHotel<br/>updateHotelInfo<br/><br/>Order:<br/>reserveHotel<br/>retrieveAllOrders<br/>retrieveUserOrders<br/>annulOrder<br/>getOrderByManager<br/>retrieveHotelOrders<br/><br/>Account:<br/>login<br/>registerAccount<br/>geetUserInfo<br/>updateInfo<br/>getCaptcha<br/>vip<br/><br/>Person:<br/>insert<br/>delete<br/>update<br/>select<br/>getByUserId<br/><br/>Comment:<br/>comment<br/>selectByHotel | 客户端API    | 服务端接口层 |
| Admin:<br/>getAllManager<br/>beforeDelete<br/>bind<br/>deleteHotel<br/>deleteuser<br/><br/>Coupon:<br/>insertCoupon<br/>selectByByHotel<br/><br/>Hotel:<br/>insertHotel<br/>updateHotel<br/>selectAllHotels<br/>selectById<br/>selectByManager<br/>unboundHotel<br/><br/>Room:<br/>insertRoom<br/>selectRoomByHotelId<br/>getRoomCurNum<br/>updateHotelInfo<br/><br/>Order:<br/>addOrder<br/>getAllOrders<br/>getUserOrders<br/>annulOrder<br/>update<br/>getOrderById<br/>getOrderByHotel<br/><br/>Comment:<br/>insert<br/>select<br/><br/>Account:<br/>getAccountByEmail<br/>getAccountByUsername<br/>select<br/>createNewAccount<br/>updateAccount<br/>beforeDelete<br/><br/>Person:<br/>insert<br/>delete<br/>update<br/>select<br/>getByUserId | 服务端数据层 | 服务端数据库 |

### 5.2 用户界面层分解

根据需求，系统存在18个用户界面：登录界面、注册界面、客户界面、酒店管理员界面（酒店管理员）、系统管理员界面、首页酒店信息界面、个人中心界面、管理酒店界面、管理账户界面、房间信息界面、酒店促销公告界面、基本信息界面、入住人信息界面、预定订单界面、酒店管理界面、订单管理界面、账户管理界面、酒店管理界面（系统管理员）。界面跳转如下图所示。
![界面跳转](https://name-not-defined.oss-cn-shanghai.aliyuncs.com/interfaceDiagram.png)

#### 5.2.1 模块职责 

| 模块   | 职责                                                 |
| ------ | ---------------------------------------------------- |
| hotel   | 酒店模块，负责展示、更新和搜索酒店信息 |
| user    | 客户模块，负责登录、注册以及客户信息的获取、更新和升级 |
| admin   | 系统管理员模块，负责获取、添加和删除酒店管理员，获取、添加和删除酒店以及酒店的绑定与解绑 |
| hotelManager | 酒店管理员模块，负责获取和添加酒店以及添加房间 |
| person  | 入住人模块，负责获取、添加、删除和更新用于预订酒店的用户信息 |
| order   | 订单模块，负责获取、添加和取消订单 |
| coupon  | 优惠券模块，负责添加和展示优惠券 |
| comment | 评论模块，负责添加和展示评论 |

#### 5.2.2 酒店模块

- 接口规范

<table>
	<tr >
	    <td rowspan="15">hotel</td>
	    <td>语法</td>
	    <td>getHotelsAPI()</td>
	</tr>
	<tr>
	    <td>前置条件</td>
	    <td>用户已注册并登陆</td>
	</tr>
	<tr>
	    <td>后置条件</td>
	    <td>展示所有酒店信息</td>
	</tr>
	<tr>
	    <td>语法</td>
	    <td>getHotelByIdAPI(param)</td>
	</tr>
	<tr><td>前置条件</td>
	    <td>用户已注册并登陆</td>
	</tr>
	<tr>
	    <td>后置条件</td>
	    <td>显示某个酒店的具体信息</td>
	</tr>
	<tr>
	    <td>语法</td>
	    <td>getUnboundHotelAPI()</td>
	</tr>
	<tr>
		<td>前置条件</td>
	    <td>系统管理员已注册并登陆</td>
	</tr>
	<tr>
	    <td>后置条件</td>
	    <td>显示未绑定状态的酒店信息</td>
	</tr>
	<tr>
	    <td>语法</td>
	    <td>updateHotelInfoAPI(data)</td>
	</tr>
	<tr>
		<td>前置条件</td>
	    <td>酒店管理员已注册并登陆</td>
	</tr>
	<tr>
	    <td>后置条件</td>
	    <td>更新酒店信息</td>
	</tr>
	<tr>
	    <td>语法</td>
	    <td>searchHotelAPI(data)</td>
	</tr>
	<tr>
		<td>前置条件</td>
	    <td>用户已注册并登陆</td>
	</tr>
	<tr>
	    <td>后置条件</td>
	    <td>显示酒店的搜索功能</td>
	</tr>
</table>



- 需要的服务接口

| 服务名                                                       | 服务                   |
| ------------------------------------------------------------ | ---------------------- |
| Controller.hotel.HotelController.retrieveAllHotels()         | 展示所有的酒店信息     |
| Controller.hotel.HotelController.retrieveHotelDetails(Integer hotelID) | 展示某个酒店的具体信息 |
| Controller.hotel.HotelController.unboundHotel() | 显示未绑定状态的酒店信息 |
| Controller.hotel.HotelController.updateHotelInfo(HotelVO hotelVO) | 更新酒店信息 |
| Controller.hotel.HotelController.fzySearch(String keyword) | 显示酒店的搜索功能 |

#### 5.2.3 客户模块

- 接口规范

<table>
	<tr >
	    <td rowspan="20">user</td>
	    <td>语法</td>
	    <td>getUserInfoAPI(id)</td>
	</tr>
	<tr>
	    <td>前置条件</td>
	    <td>用户已注册并登陆</td>
	</tr>
	<tr>
	    <td>后置条件</td>
	    <td>返回用户信息</td>
	</tr>
	<tr>
	    <td>语法</td>
	    <td>updateUserInfo(data)</td>
	</tr>
	<tr><td>前置条件</td>
	    <td>用户已注册并登陆</td>
	</tr>
	<tr>
	    <td>后置条件</td>
	    <td>更新用户信息并返回</td>
	</tr>
	<tr>
	    <td>语法</td>
	    <td>loginAPI(data)</td>
	</tr>
	<tr><td>前置条件</td>
	    <td>用户开启酒店预订系统</td>
	</tr>
	<tr>
	    <td>后置条件</td>
	    <td>提供用户登录入口</td>
	</tr>
	<tr>
	    <td>语法</td>
	    <td>registerAPI(data)</td>
	</tr>
	<tr><td>前置条件</td>
	    <td>用户开启酒店预订系统</td>
	</tr>
	<tr>
	    <td>后置条件</td>
	    <td>提供用户注册入口</td>
	</tr>
	<tr>
	    <td>语法</td>
	    <td>getCaptchaAPI()</td>
	</tr>
	<tr><td>前置条件</td>
	    <td>用户登录系统</td>
	</tr>
	<tr>
	    <td>后置条件</td>
	    <td>显示验证码</td>
	</tr>
	<tr>
	    <td>语法</td>
	    <td>upgradeToVIPAPI(data)</td>
	</tr>
	<tr><td>前置条件</td>
	    <td>用户选择升级VIP</td>
	</tr>
	<tr>
	    <td>后置条件</td>
	    <td>升级用户为VIP用户</td>
	</tr>
</table>



- 需要的服务接口

| 服务名                                        | 服务         |
| --------------------------------------------- | ------------ |
| Controller.user.AccountController.getUserInfo | 获取客户信息 |
| Controller.user.AccountController.updateInfo  | 更新客户信息 |
| Controller.user.AccountController.login(UserForm userForm) | 提供用户登录入口 |
| Controller.user.AccountController.registerAccount(UserVO userVO) | 提供用户注册入口 |
| Controller.user.AccountController.getCaptcha() | 显示验证码 |
| Controller.user.AccountController.vip(VipForm vipForm) | 升级用户为VIP用户 |

#### 5.2.4 系统管理员模块

- 接口规范

<table>
	<tr >
	    <td rowspan="26">admin</td>
	    <td>语法</td>
	    <td>getManagerListAPI()</td>
	</tr>
	<tr>
	    <td>前置条件</td>
	    <td>系统管理员已登录</td>
	</tr>
	<tr>
	    <td>后置条件</td>
	    <td>显示所有酒店管理员信息</td>
	</tr>
	<tr>
	    <td>语法</td>
	    <td>addManagerAPI(data)</td>
	</tr>
	<tr><td>前置条件</td>
	    <td>系统管理员已登录</td>
	</tr>
	<tr>
	    <td>后置条件</td>
	    <td>成功添加酒店管理员账号并显示</td>
	</tr>
	<tr>
	    <td>语法</td>
	    <td>bindHotelAndManagerAPI(data)</td>
	</tr>
	<tr><td>前置条件</td>
	    <td>系统管理员已登录</td>
	</tr>
	<tr>
	    <td>后置条件</td>
	    <td>绑定与解绑酒店管理员和酒店</td>
	</tr>
	<tr>
	    <td>语法</td>
	    <td>deleteUserAPI(data)</td>
	</tr>
	<tr><td>前置条件</td>
	    <td>系统管理员已登录</td>
	</tr>
	<tr>
	    <td>后置条件</td>
	    <td>删除酒店管理员</td>
	</tr>
	<tr>
	    <td>语法</td>
	    <td>deleteHotelAPI(data)</td>
	</tr>
	<tr><td>前置条件</td>
	    <td>系统管理员已登录</td>
	</tr>
	<tr>
	    <td>后置条件</td>
	    <td>删除酒店</td>
	</tr>
</table>



- 需要的服务接口

| 服务名                                                       | 服务                     |
| ------------------------------------------------------------ | ------------------------ |
| Controller.admin.AdminController.getAllManagers()            | 获得所有酒店管理人员信息 |
| Controller.admin.AdminController.addManager(UserForm userForm) | 添加酒店管理员账号       |
| Controller.admin.AdminController.bindToManager(int hotelId, int managerId) | 绑定与解绑酒店管理员和酒店 |
| Controller.admin.AdminController.deleteUser(int id) | 删除用户 |
| Controller.admin.AdminController.deleteHotel(int id) | 删除酒店 |

#### 5.2.5 酒店管理员模块 

- 接口规范

<table>
	<tr >
	    <td rowspan="6">hotelManager</td>
	    <td>语法</td>
	    <td>addRoomAPI(data)</td>
	</tr>
	<tr>
	    <td>前置条件</td>
	    <td>酒店管理员已登录</td>
	</tr>
	<tr>
	    <td>后置条件</td>
	    <td>添加房间信息</td>
	</tr>
	<tr>
	    <td>语法</td>
	    <td>getHotelByManagerAPI(data)</td>
	</tr>
	<tr><td>前置条件</td>
	    <td>酒店管理员已登录</td>
	</tr>
	<tr>
	    <td>后置条件</td>
	    <td>显示酒店管理员管理的酒店信息</td>
	</tr>
</table>



- 需要的服务接口

| 服务名                                                       | 服务                     |
| ------------------------------------------------------------ | ------------------------ |
| Controller.hotel.HotelController.addRoomInfo(Room room)            | 添加房间信息 |
| Controller.hotel.HotelController.getHotelByManager(int managerId) | 显示酒店管理员管理的酒店信息 |

#### 5.2.6 入住人模块

- 接口规范

<table>
	<tr >
	    <td rowspan="26">person</td>
	    <td>语法</td>
	    <td>addUserInfoAPI(data)</td>
	</tr>
	<tr>
	    <td>前置条件</td>
	    <td>用户已登录</td>
	</tr>
	<tr>
	    <td>后置条件</td>
	    <td>添加入住人信息</td>
	</tr>
	<tr>
	    <td>语法</td>
	    <td>userAllPersonsAPI(userId)</td>
	</tr>
	<tr><td>前置条件</td>
	    <td>用户已登录</td>
	</tr>
	<tr>
	    <td>后置条件</td>
	    <td>显示某个用户所属的入住人信息</td>
	</tr>
	<tr>
	    <td>语法</td>
	    <td>deletePersonAPI(id)</td>
	</tr>
	<tr><td>前置条件</td>
	    <td>用户已登录</td>
	</tr>
	<tr>
	    <td>后置条件</td>
	    <td>删除入住人信息</td>
	</tr>
	<tr>
	    <td>语法</td>
	    <td>updatePersonInfoAPI(data)</td>
	</tr>
	<tr><td>前置条件</td>
	    <td>用户已登录</td>
	</tr>
	<tr>
	    <td>后置条件</td>
	    <td>更新入住人信息</td>
	</tr>
</table>



- 需要的服务接口

| 服务名                                                       | 服务                     |
| ------------------------------------------------------------ | ------------------------ |
| Controller.user.PersonController.insert(PersonVO personVO) | 添加入住人信息 |
| Controller.user.PersonController.getByUserId(int userId) | 显示某个用户所属的入住人信息 |
| Controller.user.PersonController.delete(int id) | 删除入住人信息 |
| Controller.user.PersonController.update(PersonVO personVO) | 更新入住人信息 |

#### 5.2.7 订单模块

- 接口规范

<table>
	<tr >
	    <td rowspan="12">order</td>
	    <td>语法</td>
	    <td>reserveHotelAPI(data)</td>
	</tr>
	<tr>
	    <td>前置条件</td>
	    <td>用户已注册、登录并选择确定预订</td>
	</tr>
	<tr>
	    <td>后置条件</td>
	    <td>增加并保存订单，成功预订酒店，更新客户订单信息和酒店订单信息</td>
	</tr>
	<tr>
	    <td>语法</td>
	    <td>getAllOrdersAPI()</td>
	</tr>
	<tr><td>前置条件</td>
	    <td>用户已注册并登录</td>
	</tr>
	<tr>
	    <td>后置条件</td>
	    <td>显示所有的订单信息</td>
	</tr>
	<tr >
	    <td>语法</td>
	    <td>getUserOrdersAPI(data)</td>
	</tr>
	<tr>
	    <td>前置条件</td>
	    <td>用户已注册并登录</td>
	</tr>
	<tr>
	    <td>后置条件</td>
	    <td>展示指定用户的订单信息</td>
	</tr>
	<tr>
	    <td>语法</td>
	    <td>cancelOrderAPI(orderId)</td>
	</tr>
	<tr><td>前置条件</td>
	    <td>用户已注册、登录，并有已生成的订单</td>
	</tr>
	<tr>
	    <td>后置条件</td>
	    <td>撤销订单，更新酒店订单信息和客户订单信息</td>
	</tr>
	<tr>
	    <td>语法</td>
	    <td>getOrderByManagerAPI(data)</td>
	</tr>
	<tr><td>前置条件</td>
	    <td>酒店管理员已登录</td>
	</tr>
	<tr>
	    <td>后置条件</td>
	    <td>显示酒店管理员管理酒店收到的订单</td>
	</tr>
</table>



- 需要的服务接口

| 服务名                                                       | 服务                       |
| ------------------------------------------------------------ | -------------------------- |
| Controller.order.OrderController.reserveHotel(OrderVO orderVO) | 预订酒店                   |
| Controller.order.OrderController.retriveAllOrders()          | 获得所有订单信息           |
| Controller.order.OrderController.retrieveUserOrders(int userid) | 获得指定用户的所有订单信息 |
| Controller.order.OrderController.annulOrder(int userid)      | 撤销订单                   |
| Controller.order.OrderController.getOrderByManager(Integer managerId) | 显示酒店管理员管理酒店收到的订单 |

#### 5.2.8 优惠券模块

- 接口规范

<table>
	<tr >
	    <td rowspan="12">coupon</td>
	    <td>语法</td>
	    <td>addCouponAPI(data)</td>
	</tr>
	<tr>
	    <td>前置条件</td>
	    <td>酒店管理员已登录</td>
	</tr>
	<tr>
	    <td>后置条件</td>
	    <td>添加优惠券</td>
	</tr>
	<tr>
	    <td>语法</td>
	    <td>hotelAllCouponsAPI(hotelId)</td>
	</tr>
	<tr><td>前置条件</td>
	    <td>酒店管理员已登录</td>
	</tr>
	<tr>
	    <td>后置条件</td>
	    <td>显示酒店所有的优惠券信息</td>
	</tr>
	<tr >
	    <td>语法</td>
	    <td>orderMatchCouponsAPI(data)</td>
	</tr>
	<tr>
	    <td>前置条件</td>
	    <td>用户已填好订单信息</td>
	</tr>
	<tr>
	    <td>后置条件</td>
	    <td>显示可用的优惠券</td>
	</tr>
</table>



- 需要的服务接口

| 服务名                                                       | 服务                       |
| ------------------------------------------------------------ | -------------------------- |
| Controller.coupon.CouponController.addCoupon(CouponVO couponVO) | 添加优惠券 |
| Controller.coupon.CouponController.getAllByHotel(Integer hotelId) | 显示酒店所有的优惠券信息 |
| Controller.coupon.CouponController.getOrderMatchCoupons(Order order) | 显示可用的优惠券 |

#### 5.2.9 评论模块

- 接口规范

<table>
	<tr >
	    <td rowspan="12">comment</td>
	    <td>语法</td>
	    <td>orderCommentAPI(data)</td>
	</tr>
	<tr>
	    <td>前置条件</td>
	    <td>用户的订单处于已入住的状态</td>
	</tr>
	<tr>
	    <td>后置条件</td>
	    <td>酒店被评价</td>
	</tr>
	<tr>
	    <td>语法</td>
	    <td>getCommentById(data)</td>
	</tr>
	<tr><td>前置条件</td>
	    <td>用户浏览酒店评论页面</td>
	</tr>
	<tr>
	    <td>后置条件</td>
	    <td>显示酒店评论信息</td>
	</tr>
</table>



- 需要的服务接口

| 服务名                                                       | 服务                       |
| ------------------------------------------------------------ | -------------------------- |
| Controller.CommentController.comment(CommentVO commentVO) | 酒店被评价 |
| Controller.CommentController.selectByHotel(int hotelId) | 显示酒店评论信息 |

### 5.3 业务逻辑层分解

#### 5.3.1 职责

| 包名      | 服务                                           |
| --------- | ---------------------------------------------- |
| bl.user   | 负责用户信息查询及修改所需的服务               |
| bl.hotel  | 负责酒店管理员管理酒店及酒店信息显示所需的服务 |
| bl.coupon | 负责优惠策略的发布，删除与生效所需的服务       |
| bl.admin  | 负责管理员管理酒店及用户的服务                 |
| bl.order  | 负责订单生成、撤销所需的服务                   |

#### 5.3.2 接口规范

| 用户服务             | 接口规范                                                     |
| -------------------- | ------------------------------------------------------------ |
| admin.addManager     | 语法：`public ResponseVO addManager(UserForm userForm);`<br/>前置条件：登录系统管理员账户<br/>后置条件：为选定酒店增加一位酒店管理员 |
| admin.getAllManagers | 语法：`public List<User> getAllManagers();`<br/>前置条件：登录系统管理员账户<br/>后置条件：获得所有酒店管理员信息 |
| admin.bindToManager  | 语法：`void bindToManager(int hotelId, int managerId);;`<br/>前置条件：登录系统管理员账户<br/>后置条件：将酒店绑定至管理员 |
| admin.deleteHotel    | 语法：`void deleteHotel(int id);`<br/>前置条件：登录系统管理员账户<br/>后置条件：所选酒店被删除 |
| admin.deleteUser     | 语法：`void deleteUser(int id);`<br/>前置条件：登录系统管理员账户<br/>后置条件：所选用户被删除 |




| 需接口                                 | 服务                         |
| -------------------------------------- | ---------------------------- |
| accountServiceI.registerAccount(user); | 增加酒店管理员               |
| adminMapper.getAllManagers             | 得到所有酒店管理员           |
| adminMapper.beforeDelete               | 解绑被删除管理员绑定的酒店   |
| accountMapper.beforeDelete             | 删除被删除用户相关的用户信息 |
| adminMapper.deleteUser                 | 删除用户                     |
| adminMapper.bind(hotelId, managerId)   | 将酒店绑定至管理员           |

---

| 酒店服务                   | 接口规范                                                     |
| -------------------------- | ------------------------------------------------------------ |
| coupon.isMatch             | 语法：`public boolean isMatch(OrderVO orderVO, Coupon coupon);`<br/>前置条件：对特定订单查询某一优惠的可用性<br/>后置条件：返回当前订单是否可用 |
| coupon.getMatchOrderCoupon | 语法：`List<Coupon> getMatchOrderCoupon(Order order);`<br/>前置条件：对特定订单查询可用优惠<br/>后置条件：返回对该订单可用的优惠列表 |
| coupon.getByHotel          | 语法：`List<Coupon> getByHotel(Integer hotelId);`<br/>前置条件：查询某酒店所提供的优惠<br/>后置条件：返回该酒店的所有优惠策略（包括已失效优惠） |
| coupon.addCoupon           | 语法：`void addCoupon(Coupon coupon);`<br/>前置条件：给定所属酒店，优惠券类型，目标金额，优惠金额有效日期，目标人群<br/>后置条件：对该酒店增加优惠策略 |

| 需接口                       | 服务                    |
| ---------------------------- | ----------------------- |
| couponMapper.selectByHotelId | 选择某酒店所有优惠      |
| couponMapper.insertCoupon    | 增加优惠                |
| personMapper.select          | 根据订单用户确定生日    |
| accountMapper.select         | 根据订单用户确定vip级别 |

---

| 优惠策略服务                | 接口规范                                                     |
| --------------------------- | ------------------------------------------------------------ |
| hotel.addHotel              | 语法：`void addHotel(HotelVO hotelVO);`<br/>前置条件：输入合法的酒店名称，星级，地区<br/>后置条件：创建酒店并自动添加初始酒店管理员账户 |
| hotel.retrieveHotels        | 语法：`List<HotelVO> retrieveHotels();`<br/>前置条件：请求酒店列表<br/>后置条件：获得酒店列表 |
| hotel.selectById            | 语法：`HotelVO selectById(Integer hotelId);`<br/>前置条件：进入酒店详情界面<br/>后置条件：返回该酒店的名称，详细描述，星级，商圈 |
| hotel.getHotelByManager     | 语法：`List<Hotel> getHotelByManager(Integer id);`<br/>前置条件：进入用户管理界面，查看某酒店管理员<br/>后置条件：返回该管理员绑定的酒店列表 |
| hotel.updateHotelInfo       | 语法：`public void updateRoomInfo(Integer hotelId, String roomType, Integer rooms);`<br/>前置条件：提交信息完整的订单<br/>后置条件：按照订单的房间类型及数量修改剩余客房信息 |
| hotel.unboundHotel  | 语法：`List<Hotel> unboundHotel();`<br/>前置条件：进入酒店管理界面<br/>后置条件：返回所有未绑定的酒店 |
| hotel.fzySearch     | 语法：`List<Hotel> fzySearch(String keyword);`<br/>前置条件：搜索栏内已键入内容<br/>后置条件：返回匹配搜索条件的酒店 |

| 优惠策略服务                | 接口规范                                                     |
| --------------------------- | ------------------------------------------------------------ |
| hotel.retrieveRoomInfo | 语法：`List<Room> retrieveRoomInfo(Integer hotelId);`<br/>前置条件：进入酒店详情界面<br/>后置条件：返回该酒店的房间类型及价格 |
| hotel.insertRoomInfo        | 语法：`void insertRoomInfo(Room room);`<br/>前置条件：填写新型房间的价格名称与数量<br/>后置条件：增加新房型 |
| hotel.updateRoomInfo        | 语法：`void updateRoomInfo(Order order);`<br/>前置条件：填写房间信息的修改表单<br/>后置条件：更新该类房间信息 |
| hotel.getRoomCurNum         | 语法：`int getRoomCurNum(Order order);`<br/>前置条件：选择预定某类房间<br/>后置条件：返回该类房间剩余可用数量 |

| 需接口                            | 服务                       |
| --------------------------------- | -------------------------- |
| hotelMapper.insertHotel           | 增加酒店                   |
| hotelMapper.selectAllHotel        | 得到所有酒店               |
| hotelMapper.selectByManager        | 得到某酒店管理员绑定的所有酒店  |
| hotelMapper.updateHotel      | 更新酒店信息  |
| hotelMapper.unboundHotel      | 得到所有未绑定酒店 |
| fzyService.similarity      | 判断关键词和搜索内容的相似度  |
| hotelMapper.selectById            | 根据id选择酒店             |
| roomMapper.selectRoomsByHotelId   | 得到某id对应酒店的房间信息 |
| roomMapper.insertRoom             | 增加房间类型               |
| roomMapper.updateRoomInfo         | 更新某类房间信息           |
| roomMapper.getRoomCurNum          | 得到房间剩余数量           |

---

| 系统管理服务            | 接口规范                                                     |
| ----------------------- | ------------------------------------------------------------ |
| order.addOrder          | 语法：`public ResponseVO addOrder(OrderVO orderVO);`<br/>前置条件：客户预定酒店<br/>后置条件：若预定成功，增加订单记录，更新酒店房间数量 |
| order.getAllOrders      | 语法：`public List<Order> getAllOrders();`<br/>前置条件：系统管理员请求管理订单<br/>后置条件：显示所有订单 |
| order.getUserOrders     | 语法：`public List<Order> getUserOrders(int userid);`<br/>前置条件：用户或系统管理员请求查看订单<br/>后置条件：显示某位用户的所有订单 |
| order.annulOrder        | 语法：`public ResponseVO annulOrder(int orderid);`<br/>前置条件：用户选择撤销订单 <br/>后置条件：该订单失效 |
| order.getHotelOrders    | 语法：`public List<Order> getHotelOrders(Integer hotelId);`<br/>前置条件：酒店管理员或系统管理员请求查看订单<br/>后置条件：显示某酒店的所有订单 |
| order.getOrderByManager | 语法：`List<Order> getOrderByManager(Integer managerId);`<br/>前置条件：酒店管理员或系统管理员请求查看订单<br/>后置条件：显示某酒店管理员的所有订单 |

| 需接口                      | 服务                 |
| --------------------------- | -------------------- |
| accountServiceI.getUserInfo  | 得到用户信息         |
| accountServiceI.creditDown  | 在撤单时调整信用        |
| hotelServiceI.updateRoomInfo | 更新某类房间信息     |
| hotelServiceI.getRoomCurNum  | 得到房间剩余数量     |
| hotelServiceI.getHotelByManager  | 得到某酒店管理员的所有订单     |
|  hotelServiceI.selectById  | 得到某酒店信息     |
| orderMapper.getOrderById       | 得到特定订单并删除     |
| orderMapper.addOrder        | 增加订单             |
| orderMapper.getAllOrders    | 得到所有订单         |
| orderMapper.getUserOrders   | 得到某用户的所有订单 |
| orderMapper.annulOrder      | 撤销订单             |
| orderMapper.getHotelByManager    | 得到某酒店管理员绑定的所有酒店      |
| roomMapper.updateRoomInfo| 更新房间信息 |

---

| 订单服务             | 接口规范                                                     |
| -------------------- | ------------------------------------------------------------ |
| user.registerAccount | 语法：`public ResponseVO registerAccount(UserVO userVO);`<br/>前置条件：用户申请注册或创建酒店时自动进行注册或系统初始化时自动注册<br/>后置条件：产生对应身份的管理员 |
| user.login           | 语法：`public User login(UserForm userForm);`<br/>前置条件：用户输入账户密码<br/>后置条件：如匹配则登录成功 |
| user.getUserInfo     | 语法：`public User getUserInfo(int id);`<br/>前置条件：用户或管理员查看某用户信息页面<br/>后置条件：返回敢用户的姓名，电话，信用值，邮箱 |
| user.updateUserInfo  | 语法：`public ResponseVO updateUserInfo(int id, String password, String username, String phonenumber);`<br/>前置条件：用户重新填写个人信息或管理员尝试修改用户信息<br/>后置条件：用户信息被改变 |
| user.creditDown     | 语法：`void creditDown(Order order);`<br/>前置条件：用户撤销订单<br/>后置条件：下调用户的信用值 |
| user.vip   | 语法：`void vip(VipForm vipForm);`<br/>前置条件：用户付款<br/>后置条件：用户升级或续期VIP |

| 需接口                         | 服务           |
| ------------------------------ | -------------- |
| accountMapper.createNewAccount | 创建新账户     |
| accountMapper.getAccountByUsername | 按名称查找账户 |
|accountMapper.getAccountByEmail|按邮箱查找账户 |
| accountMapper.select   | 按id查找账户   |
| accountMapper.updateAccount    | 更新账户信息   |
| accountMapper.updateAccount    | 更新账户信息   |
| personMapper.select    | 按id查找用户   |

---

| 订单服务             | 接口规范                                                     |
| -------------------- | ------------------------------------------------------------ |
| person.insert | 语法：`void insert(Person person);`<br/>前置条件：以账户用户身份进入个人信息管理界面<br/>后置条件：增加用户 |
| person.delete        | 语法：`void delete(int id);`<br/>前置条件：以普账户户身份进入个人信息管理界面<br/>后置条件：删除用户 |
| person.update    | 语法：`void update(Person person);`<br/>前置条件：提交用户信息更新表单<br/>后置条件：改变该用户信息 |
|person.selectByUserId | 语法：`List<Person> selectByUserId(int userId);`<br/>前置条件：以普通账户身份进入个人信息管理界面<br/>后置条件：列表显示该账户的所有用户 |
|person.select     | 语法：`Person select(int id) throws OopsException;`<br/>前置条件：查询所述该用户的个人信息id<br/>后置条件：得到详细个人信息表述 |

| 需接口                         | 服务           |
| ------------------------------ | -------------- |
| personMapper.selectByUserId    | 得到账户的所有用户  |
| personMapper.select    | 按id查找用户  |
| personMapper.delete    | 删除用户  |
| personMapper.update    | 更新用户  |
| personMapper.update    | 增加用户  |

---

| 订单服务             | 接口规范                                                     |
| -------------------- | ------------------------------------------------------------ |
| comment.comment | 语法：`List<CommentVO> getComment(int id);`<br/>前置条件：浏览酒店详细信息<br/>后置条件：列表显示该酒店的评论 |
| comment.getComment   | 语法：`void comment(CommentVO commentVO);`<br/>前置条件：选中已完成且未评价的订单<br/>后置条件：更新订单所属酒店的评论列表 |

| 需接口                         | 服务           |
| ------------------------------ | -------------- |
| orderMapper.getOrderById | 按id查找订单  |
| orderMapper.update | 更新订单信息 |
| accountMapper.select   | 按id查找账户   |
| commentMapper.insert | 增加评论 |
| commentMapper.select | 按id查找评论 |

### 5.4 数据层分解

&emsp;&emsp;数据层主要是给业务逻辑层提供数据访问服务，包括对于持久化数据的增、删、改、查。Hotel业务逻辑需要的服务由HotelServiceImpl提供。由于持久化数据的保存采用了MySQL数据库的形式所以抽象了数据服务。数据层额描述具体如图所示。

![](https://name-not-defined.oss-cn-shanghai.aliyuncs.com/data.png)

图 数据层模块的描述

#### 5.4.1职责

| 模块          | 职业                                       |
| ------------- | ------------------------------------------ |
| HotelServiceI | 持久化数据库的接口，提供增、删、改、查服务 |
| OrderServiceI | 持久化数据库的接口，提供增、删、改、查服务 |
| AccountServiceI | 持久化数据库的接口，提供增、删、改、查服务 |
| PersonServiceI  |持久化数据库的接口，提供增、删、改、查服务|
| AdminServiceI|持久化数据库的接口，提供增、删、改、查服务|
|RoomServiceI|持久化数据库的接口，提供增、删、改、查服务|
|CouponServiceI|持久化数据库的接口，提供增、删、改、查服务|
|CommentServiceI|持久化数据库的接口，提供增、删、改、查服务|
|CouponMatchStrategyI|持久化数据库的接口，提供查服务|



#### 5.4.2接口规范

![接口规范](https://name-not-defined.oss-cn-shanghai.aliyuncs.com/data2.png)

### 6.信息视角

#### 6.1数据持久化对象

&emsp;&emsp;系统的PO类就是对应的相关的实体类，在此只作简单介绍。

- CouponPO类包含优惠券的ID、描述、优惠酒店ID、类型、名称、使用门槛、折扣、优惠金额、可用时间、失效时间、可用状态。
- HotelPO类包含酒店的ID、名称、地址、商圈、星级、评价、描述、联系电话、酒店管理员id。
- RoomPO类包含了酒店房间的ID、类型、酒店ID、价格、剩余可预订房间数、某类型总房间数。
- OrderPO类包含了订单的ID、用户ID、酒店ID、酒店蒙城、入住时间、退房时间、房间类型、房间数量、入住人数、是否有儿童、订单创建时间、价格、客户姓名、联系电话、订单状态。
- UserPO类包含了客户的ID、电子邮箱、密码、用户名、联系电话、信用值、用户类型。
- CommentPO类包含了客户的ID，酒店的编号，用户的评分，评论内容
- PersonPO类包含了客户的ID，客户的真实姓名，客户的账户ID，客户的手机号，客户的生日。

持久化用户对象CommentPO定义如下代码所示。

```java
package com.example.hotel.model;

import lombok.Data;

@Data
public class Comment {

    private int id;
    private int userId;
    private int hotelId;
    private int score;
    private String title;
    private String content;

    public Comment() {
        title = "";
        content = "";
    }

}
```

持久化用户对象CouponPO定义如下代码所示。

```java
package com.example.hotel.model;

import com.example.hotel.enums.CouponStatus;
import com.example.hotel.enums.CouponType;
import com.example.hotel.enums.VipType;
import lombok.Data;

import java.time.LocalDateTime;

@Data
public class Coupon {

    /**
     * 优惠券id
     */
    private int id;
    /**
     * 优惠券描述
     */
    private String description;
    /**
     * 如果为-1 代表是网站推出的优惠
     */
    private Integer hotelId;
    /**
     * 优惠券类型 1生日特惠 2多间特惠 3满减优惠 4限时优惠
     */
    private CouponType type;
    /**
     * 优惠券名称
     */
    private String name;
    /**
     * 优惠券使用门槛
     */
    private double targetMoney;
    /**
     * 折扣
     */
    private double discount;
    /**
     * 优惠券优惠金额
     */
    private double discountMoney;
    /**
     * 可用时间
     */
    private LocalDateTime startTime;
    /**
     * 失效时间
     */
    private LocalDateTime endTime;
    /**
     * 优惠券状态 是否已经失效 1可用 0失效
     */
    private CouponStatus status;

    private int multiRoomTarget;
    private VipType level;

    public Coupon() {
        name = "Coupon";
        hotelId = -1;
        status = CouponStatus.Available;
        discount = 1;
        description = "";
        targetMoney = 1e8;
        discountMoney = 0;
        multiRoomTarget = (int) 1e8;
        startTime = LocalDateTime.now();
        endTime = startTime.plusDays(30);
        level = VipType.Nil;
    }

}
```



持久化用户对象HotelPO定义如下代码所示。

```java
package com.example.hotel.model;

import com.example.hotel.enums.BizRegion;
import com.example.hotel.enums.HotelStar;
import lombok.Data;

@Data
public class Hotel {

    private Integer id;
    private String name;
    private String address;
    private BizRegion bizRegion;
    private HotelStar hotelStar;
    private Double rate;
    private String description;
    private String phoneNumber;
    private Integer managerId;
    private String pic;
    private String announcement;

    public Hotel() {
        name = "";
        address = "";
        bizRegion = BizRegion.XiDan;
        rate = 5.0;
        description = "";
        managerId = -1;
        pic = "https://hotel-res-img-public.oss-cn-shanghai.aliyuncs.com/static/cover.jpg";
        announcement = "";
    }

}
```



持久化用户对象RoomPO定义如下代码所示。

```java
package com.example.hotel.model;

import com.example.hotel.enums.RoomType;
import lombok.Data;

@Data
public class Room {

    private Integer id;
    private RoomType roomType;
    private Integer hotelId;
    private Double price;

    /**
     * 当前剩余可预定房间数
     */
    private Integer curNum;
    /**
     * 某类型房间总数
     */
    private Integer total;
    private Boolean breakfast;
    private Integer peopleMax;

    public Room() {
        breakfast = false;
        peopleMax = 2;
    }

}
```



持久化用户对象OrderPO定义如下代码所示。

```java
package com.example.hotel.model;

import com.example.hotel.enums.OrderState;
import lombok.Data;

import java.time.LocalDate;
import java.time.LocalDateTime;

@Data
public class Order {

    private int id;
    private int personId;
    private int hotelId;
    private LocalDate checkInDate;
    private LocalDate checkOutDate;
    private String roomType;
    private int roomNum;
    private int peopleNum;
    private Boolean haveChild;
    private Boolean breakfast;
    private LocalDateTime createDate;
    private Double price;
    private OrderState orderState;
    private int commentId;

    public Order() {
        breakfast = false;
        createDate = LocalDateTime.now();
        orderState = OrderState.Available;
        commentId = -1;
        breakfast = false;
    }

}
```



持久化用户对象PersonPO定义如下代码所示。

```java
package com.example.hotel.model;

import lombok.Data;

import java.time.LocalDate;

@Data
public class Person {

    private int id;
    private int userId;
    private String realName;
    private String idNo;
    private String phoneNumber;
    private LocalDate birthday;

    public Person() {
        realName = "default_real_name";
        phoneNumber = "12345678910";
        birthday = LocalDate.now();
    }

}
```



持久化用户对象UserPO定义如下代码所示。

```java
package com.example.hotel.model;

import com.example.hotel.enums.UserType;
import com.example.hotel.enums.VipType;
import lombok.Data;

import java.time.LocalDateTime;

@Data
public class User {

    private Integer id;
    private String email;
    private String password;
    private String username;
    private Double credit;
    private UserType userType;
    private String avatar;
    private LocalDateTime vipEnd;
    private VipType vipType;

    public User() {
        credit = 100.0;
        avatar = "https://hotel-res-img-public.oss-cn-shanghai.aliyuncs.com/static/cover.jpg";
        userType = UserType.Client;
        username = "default_username";
        password = "default_password";
        vipEnd = LocalDateTime.now();
        vipType=VipType.Small;

    }

}
```

#### 6.2数据库表

&emsp;&emsp;数据库中包含Coupon表、Hotel表、Order表、Room表、User表、Comment表、person表。

## 7. 文档修改历史

| 修改人员 | 日期       | 修改原因                                             | 版本号 |
| :------: | ---------- | ---------------------------------------------------- | ------ |
|  杜铭哲  | 2020.6.15 22:43 | 完成模块职责的编写              | v1.0 |
|  黄雨晨  | 2020.6.16 13:40 | 完成层之间调用接口与业务层逻辑分解 | v1.0 |
