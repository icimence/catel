# 软件详细设计文档

## 目录

[TOC]

## 1.引言

### 1.1编制目的

本报告详细完成对线上酒店预订系统的详细设计，以达到指导后续软件构造过程的目的，同时实现各方开发人员及用户的信息沟通。
本报告面向开发人员，测试人员，终端用户变现，作为系统指南。

### 1.2词汇表

| 词汇名称 | 词汇含义          | 备注                    |
| :------: | ----------------- | ----------------------- |
|   MVC    | 模型-视图-控制    | 无                      |
|    *     | com.example.hotel | 逻辑视图中包名称用*代替 |

### 1.3 参考资料

- 《软件工程与计算（卷二）：软件开发的技术基础》

- MVC模式 | 菜鸟教程

## 2. 产品概述

酒店预订系统是为有线上进行酒店预订需求的客户以及支持线上预订业务的酒店开发的业务系统，开发的目标是帮助客户完成预订目标酒店房间服务和帮助入驻酒店处理预订订单业务。

通过酒店预订系统的应用，期望为使用的客户带来便捷，使其更为快捷地预定到满意的酒店，同时使入驻酒店更为便利地处理客户需求和订单，为入驻酒店引入更多客户和订单，提高营业额和利润。

## 3.体系结构设计概述

酒店预订系统中，选择了MVC体系结构风格，为模型、视图和控制的每个部件实例建立模块实现。模型代表一个存储数据的对象或JAVA POJO，它也可以带有逻辑，在数据变化时更新控制器；视图代表模型包含的数据的可视化；控制器作用于模型和视图上，它控制数据流向模型对象，并在数据变化时更新视图，它使视图与模型分离开。MVC体系结构的逻辑视角和逻辑设计方案如图1和图2所示。

![](https://name-not-defined.oss-cn-shanghai.aliyuncs.com/pkgfinal.png)

图1 参照体系结构风格的包图表达逻辑视角

![](https://name-not-defined.oss-cn-shanghai.aliyuncs.com/designMethod.png)

图2 软件体系结构逻辑设计方案

## 4.结构视角

### 4.1业务逻辑层分解

（1）模块概述

| 包名      | 服务                                           |
| --------- | ---------------------------------------------- |
| bl.user   | 负责用户信息查询及修改所需的服务               |
| bl.hotel  | 负责酒店管理员管理酒店及酒店信息显示所需的服务 |
| bl.coupon | 负责优惠策略的发布，删除与生效所需的服务       |
| bl.admin  | 负责管理员管理酒店及用户的服务                 |
| bl.order  | 负责订单生成、撤销所需的服务                   |

（2）整体结构

我们将后端系统分解为控制器层，业务逻辑层，数据持久层。出于灵活性的考虑，层间调用均采用控制反转，通过接口连接。其中，控制器层通过 `bl` 接口层调用 `blImpl` 业务逻辑实现层，而 `blImpl` 层通过 `Mapper` 接口调用由 `Mybatis` 自动生成的数据层存取实现。
其余部分较为复杂的服务，例如系统异常处理，对象存储服务，模糊搜索逻辑，验证码生成等，均被封装好后作为 `Service` 注入 Spring 容器以供调用，放置于 `util` 包中。
本构架采用贫血的 MVC 模型，即不在持久层数据对象中加入多余的逻辑，仅提供 `getter` 和 `setter` 方法，将数据的存取和业务逻辑完全解耦。

（3）模块内部类的接口规范


| 用户服务             | 接口规范                                                     |
| -------------------- | ------------------------------------------------------------ |
| admin.addManager     | 语法：`public ResponseVO addManager(UserForm userForm);`<br/>前置条件：登录系统管理员账户<br/>后置条件：为选定酒店增加一位酒店管理员 |
| admin.getAllManagers | 语法：`public List<User> getAllManagers();`<br/>前置条件：登录系统管理员账户<br/>后置条件：获得所有酒店管理员信息 |
| admin.bindToManager  | 语法：`void bindToManager(int hotelId, int managerId);;`<br/>前置条件：登录系统管理员账户<br/>后置条件：将酒店绑定至管理员 |
| admin.deleteHotel    | 语法：`void deleteHotel(int id);`<br/>前置条件：登录系统管理员账户<br/>后置条件：所选酒店被删除 |
| admin.deleteUser     | 语法：`void deleteUser(int id);`<br/>前置条件：登录系统管理员账户<br/>后置条件：所选用户被删除 |




| 需接口                                 | 服务                         |
| -------------------------------------- | ---------------------------- |
| accountServiceI.registerAccount(user); | 增加酒店管理员               |
| adminMapper.getAllManagers             | 得到所有酒店管理员           |
| adminMapper.beforeDelete               | 解绑被删除管理员绑定的酒店   |
| accountMapper.beforeDelete             | 删除被删除用户相关的用户信息 |
| adminMapper.deleteUser                 | 删除用户                     |
| adminMapper.bind(hotelId, managerId)   | 将酒店绑定至管理员           |

---

| 酒店服务                   | 接口规范                                                     |
| -------------------------- | ------------------------------------------------------------ |
| coupon.isMatch             | 语法：`public boolean isMatch(OrderVO orderVO, Coupon coupon);`<br/>前置条件：对特定订单查询某一优惠的可用性<br/>后置条件：返回当前订单是否可用 |
| coupon.getMatchOrderCoupon | 语法：`List<Coupon> getMatchOrderCoupon(Order order);`<br/>前置条件：对特定订单查询可用优惠<br/>后置条件：返回对该订单可用的优惠列表 |
| coupon.getByHotel          | 语法：`List<Coupon> getByHotel(Integer hotelId);`<br/>前置条件：查询某酒店所提供的优惠<br/>后置条件：返回该酒店的所有优惠策略（包括已失效优惠） |
| coupon.addCoupon           | 语法：`void addCoupon(Coupon coupon);`<br/>前置条件：给定所属酒店，优惠券类型，目标金额，优惠金额有效日期，目标人群<br/>后置条件：对该酒店增加优惠策略 |

| 需接口                       | 服务                    |
| ---------------------------- | ----------------------- |
| couponMapper.selectByHotelId | 选择某酒店所有优惠      |
| couponMapper.insertCoupon    | 增加优惠                |
| personMapper.select          | 根据订单用户确定生日    |
| accountMapper.select         | 根据订单用户确定vip级别 |

---

| 优惠策略服务            | 接口规范                                                     |
| ----------------------- | ------------------------------------------------------------ |
| hotel.addHotel          | 语法：`void addHotel(HotelVO hotelVO);`<br/>前置条件：输入合法的酒店名称，星级，地区<br/>后置条件：创建酒店并自动添加初始酒店管理员账户 |
| hotel.retrieveHotels    | 语法：`List<HotelVO> retrieveHotels();`<br/>前置条件：请求酒店列表<br/>后置条件：获得酒店列表 |
| hotel.selectById        | 语法：`HotelVO selectById(Integer hotelId);`<br/>前置条件：进入酒店详情界面<br/>后置条件：返回该酒店的名称，详细描述，星级，商圈 |
| hotel.getHotelByManager | 语法：`List<Hotel> getHotelByManager(Integer id);`<br/>前置条件：进入用户管理界面，查看某酒店管理员<br/>后置条件：返回该管理员绑定的酒店列表 |
| hotel.updateHotelInfo   | 语法：`public void updateRoomInfo(Integer hotelId, String roomType, Integer rooms);`<br/>前置条件：提交信息完整的订单<br/>后置条件：按照订单的房间类型及数量修改剩余客房信息 |
| hotel.unboundHotel      | 语法：`List<Hotel> unboundHotel();`<br/>前置条件：进入酒店管理界面<br/>后置条件：返回所有未绑定的酒店 |
| hotel.fzySearch         | 语法：`List<Hotel> fzySearch(String keyword);`<br/>前置条件：搜索栏内已键入内容<br/>后置条件：返回匹配搜索条件的酒店 |

| 优惠策略服务                | 接口规范                                                     |
| --------------------------- | ------------------------------------------------------------ |
| hotel.retrieveRoomInfo | 语法：`List<Room> retrieveRoomInfo(Integer hotelId);`<br/>前置条件：进入酒店详情界面<br/>后置条件：返回该酒店的房间类型及价格 |
| hotel.insertRoomInfo        | 语法：`void insertRoomInfo(Room room);`<br/>前置条件：填写新型房间的价格名称与数量<br/>后置条件：增加新房型 |
| hotel.updateRoomInfo        | 语法：`void updateRoomInfo(Order order);`<br/>前置条件：填写房间信息的修改表单<br/>后置条件：更新该类房间信息 |
| hotel.getRoomCurNum         | 语法：`int getRoomCurNum(Order order);`<br/>前置条件：选择预定某类房间<br/>后置条件：返回该类房间剩余可用数量 |

| 需接口                          | 服务                           |
| ------------------------------- | ------------------------------ |
| hotelMapper.insertHotel         | 增加酒店                       |
| hotelMapper.selectAllHotel      | 得到所有酒店                   |
| hotelMapper.selectByManager     | 得到某酒店管理员绑定的所有酒店 |
| hotelMapper.updateHotel         | 更新酒店信息                   |
| hotelMapper.unboundHotel        | 得到所有未绑定酒店             |
| fzyService.similarity           | 判断关键词和搜索内容的相似度   |
| hotelMapper.selectById          | 根据id选择酒店                 |
| roomMapper.selectRoomsByHotelId | 得到某id对应酒店的房间信息     |
| roomMapper.insertRoom           | 增加房间类型                   |
| roomMapper.updateRoomInfo       | 更新某类房间信息               |
| roomMapper.getRoomCurNum        | 得到房间剩余数量               |

---

| 系统管理服务            | 接口规范                                                     |
| ----------------------- | ------------------------------------------------------------ |
| order.addOrder          | 语法：`public ResponseVO addOrder(OrderVO orderVO);`<br/>前置条件：客户预定酒店<br/>后置条件：若预定成功，增加订单记录，更新酒店房间数量 |
| order.getAllOrders      | 语法：`public List<Order> getAllOrders();`<br/>前置条件：系统管理员请求管理订单<br/>后置条件：显示所有订单 |
| order.getUserOrders     | 语法：`public List<Order> getUserOrders(int userid);`<br/>前置条件：用户或系统管理员请求查看订单<br/>后置条件：显示某位用户的所有订单 |
| order.annulOrder        | 语法：`public ResponseVO annulOrder(int orderid);`<br/>前置条件：用户选择撤销订单 <br/>后置条件：该订单失效 |
| order.getHotelOrders    | 语法：`public List<Order> getHotelOrders(Integer hotelId);`<br/>前置条件：酒店管理员或系统管理员请求查看订单<br/>后置条件：显示某酒店的所有订单 |
| order.getOrderByManager | 语法：`List<Order> getOrderByManager(Integer managerId);`<br/>前置条件：酒店管理员或系统管理员请求查看订单<br/>后置条件：显示某酒店管理员的所有订单 |

| 需接口                          | 服务                           |
| ------------------------------- | ------------------------------ |
| accountServiceI.getUserInfo     | 得到用户信息                   |
| accountServiceI.creditDown      | 在撤单时调整信用               |
| hotelServiceI.updateRoomInfo    | 更新某类房间信息               |
| hotelServiceI.getRoomCurNum     | 得到房间剩余数量               |
| hotelServiceI.getHotelByManager | 得到某酒店管理员的所有订单     |
| hotelServiceI.selectById        | 得到某酒店信息                 |
| orderMapper.getOrderById        | 得到特定订单并删除             |
| orderMapper.addOrder            | 增加订单                       |
| orderMapper.getAllOrders        | 得到所有订单                   |
| orderMapper.getUserOrders       | 得到某用户的所有订单           |
| orderMapper.annulOrder          | 撤销订单                       |
| orderMapper.getHotelByManager   | 得到某酒店管理员绑定的所有酒店 |
| roomMapper.updateRoomInfo       | 更新房间信息                   |

---

| 订单服务             | 接口规范                                                     |
| -------------------- | ------------------------------------------------------------ |
| user.registerAccount | 语法：`public ResponseVO registerAccount(UserVO userVO);`<br/>前置条件：用户申请注册或创建酒店时自动进行注册或系统初始化时自动注册<br/>后置条件：产生对应身份的管理员 |
| user.login           | 语法：`public User login(UserForm userForm);`<br/>前置条件：用户输入账户密码<br/>后置条件：如匹配则登录成功 |
| user.getUserInfo     | 语法：`public User getUserInfo(int id);`<br/>前置条件：用户或管理员查看某用户信息页面<br/>后置条件：返回敢用户的姓名，电话，信用值，邮箱 |
| user.updateUserInfo  | 语法：`public ResponseVO updateUserInfo(int id, String password, String username, String phonenumber);`<br/>前置条件：用户重新填写个人信息或管理员尝试修改用户信息<br/>后置条件：用户信息被改变 |
| user.creditDown      | 语法：`void creditDown(Order order);`<br/>前置条件：用户撤销订单<br/>后置条件：下调用户的信用值 |
| user.vip             | 语法：`void vip(VipForm vipForm);`<br/>前置条件：用户付款<br/>后置条件：用户升级或续期VIP |

| 需接口                             | 服务           |
| ---------------------------------- | -------------- |
| accountMapper.createNewAccount     | 创建新账户     |
| accountMapper.getAccountByUsername | 按名称查找账户 |
| accountMapper.getAccountByEmail    | 按邮箱查找账户 |
| accountMapper.select               | 按id查找账户   |
| accountMapper.updateAccount        | 更新账户信息   |
| accountMapper.updateAccount        | 更新账户信息   |
| personMapper.select                | 按id查找用户   |

---

| 订单服务              | 接口规范                                                     |
| --------------------- | ------------------------------------------------------------ |
| person.insert         | 语法：`void insert(Person person);`<br/>前置条件：以账户用户身份进入个人信息管理界面<br/>后置条件：增加用户 |
| person.delete         | 语法：`void delete(int id);`<br/>前置条件：以普账户户身份进入个人信息管理界面<br/>后置条件：删除用户 |
| person.update         | 语法：`void update(Person person);`<br/>前置条件：提交用户信息更新表单<br/>后置条件：改变该用户信息 |
| person.selectByUserId | 语法：`List<Person> selectByUserId(int userId);`<br/>前置条件：以普通账户身份进入个人信息管理界面<br/>后置条件：列表显示该账户的所有用户 |
| person.select         | 语法：`Person select(int id) throws OopsException;`<br/>前置条件：查询所述该用户的个人信息id<br/>后置条件：得到详细个人信息表述 |

| 需接口                      | 服务               |
| --------------------------- | ------------------ |
| personMapper.selectByUserId | 得到账户的所有用户 |
| personMapper.select         | 按id查找用户       |
| personMapper.delete         | 删除用户           |
| personMapper.update         | 更新用户           |
| personMapper.update         | 增加用户           |

---

| 订单服务           | 接口规范                                                     |
| ------------------ | ------------------------------------------------------------ |
| comment.comment    | 语法：`List<CommentVO> getComment(int id);`<br/>前置条件：浏览酒店详细信息<br/>后置条件：列表显示该酒店的评论 |
| comment.getComment | 语法：`void comment(CommentVO commentVO);`<br/>前置条件：选中已完成且未评价的订单<br/>后置条件：更新订单所属酒店的评论列表 |

| 需接口                   | 服务         |
| ------------------------ | ------------ |
| orderMapper.getOrderById | 按id查找订单 |
| orderMapper.update       | 更新订单信息 |
| accountMapper.select     | 按id查找账户 |
| commentMapper.insert     | 增加评论     |
| commentMapper.select     | 按id查找评论 |

（4）业务逻辑层的动态模型

图3展示在线上酒店预订系统中客户提交酒店预订表单后相关对象间的协作调用。
![](https://name-not-defined.oss-cn-shanghai.aliyuncs.com/pic13.png)

图4表示在线上酒店预订系统中酒店列表的查询与显示。
![](https://name-not-defined.oss-cn-shanghai.aliyuncs.com/pic14.png)

（5）业务逻辑层的设计原理
业务逻辑层接受视图对象并将处理后得到的持久层对象传递给数据持久化层，保证了UI逻辑与数据逻辑隔离，同时在必要的时候能够在转化前调用业务逻辑层内其他的服务进行预处理。
业务逻辑层优先向下调用数据映射层，仅当其处理逻辑中完整地包含了另一个服务时（如创建酒店管理员账户首先包含了账户的创建）允许层内调用。

## 5. 依赖视角

如下为客户端和服务器端各自的包图及依赖关系。

![](https://name-not-defined.oss-cn-shanghai.aliyuncs.com/pic4.1.1.png)

图5 客户端包图

![](https://name-not-defined.oss-cn-shanghai.aliyuncs.com/pic4.1.2.png)

图6 服务器端包图

## 6. 变更记录

|  提交日期  | 提交时间 | 提交者 | 更新内容                                                    |
| :--------: | :------: | :----: | ----------------------------------------------------------- |
|2020.06.27|20 : 00|黄雨晨| 完成第三阶段的详细设计文档 |
